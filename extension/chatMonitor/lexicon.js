(function () {

  const ESCALATION_SIGNS = [
    "!!!!!", "!!!!", "???", "?!", "!?", "â€¦â€¦", "...!!!"
  ];

  const LEXICON = {
    he: {
      // =====================
      // ðŸŸ¢ POSITIVE / ×ž×¨×›×š / ×ž××–Öµ×Ÿ
      // =====================
      positive_phrases: [
        // ×‘×¡×™×¡×™ ×•××™×©×•×¨
        "××™×Ÿ ×‘×¢×™×”", "×‘×œ×™ ×‘×¢×™×”", "×‘×©×ž×—×”", "×›×ž×•×‘×Ÿ", "×‘×˜×—", "×¡×‘×‘×”", "×ž×¢×•×œ×”", "×ž×¦×•×™×Ÿ", "× ×”×“×¨",
        "×”×›×œ ×˜×•×‘", "×”×›×•×œ ×‘×¡×“×¨", "×”×›×œ ×‘×¡×“×¨ ×’×ž×•×¨", "××™×Ÿ ×“××’×”", "××™×Ÿ ×©×•× ×‘×¢×™×”",
        "×‘×©×ž×—×” ×¨×‘×”", "×‘×©×ž×—×” ×’×“×•×œ×”", "×‘×•×•×“××™", "×›×ž×•×‘×Ÿ ×©×›×Ÿ", "×‘×©×‘×™×œ ×–×” ×× ×™ ×›××Ÿ",

        // × ×™×ž×•×¡ ×•×”×›×¨×ª ×ª×•×“×”
        "×ª×•×“×”", "×ª×•×“×” ×¨×‘×”", "×”×ž×•×Ÿ ×ª×•×“×”", "×ª×•×“×” ×’×“×•×œ×”", "×ž×¢×¨×™×›×” ×ž××•×“", "×ž×¢×¨×™×š ×ž××•×“",
        "×ª×•×“×” ×¢×œ ×”×¢×“×›×•×Ÿ", "×ª×•×“×” ×¢×œ ×”×”×‘×”×¨×”", "×ª×•×“×” ×¢×œ ×”×˜×™×¤×•×œ", "×ž×•×“×” ×œ×š", "×ž×•×“×” ×œ×›×",
        "×ž×¢×¨×™×›×” ××ª ×–×”", "×ž×¢×¨×™×š ××ª ×–×”", "×ž×•×§×™×¨×” ×ª×•×“×”", "×‘×”×¢×¨×›×”",

        // ×¨×™×›×•×š ×‘×§×©×•×ª
        "××©×ž×—", "××©×ž×— ×ž××•×“", "××©×ž×— ×œ×¢×“×›×•×Ÿ", "××©×ž×— ×œ×©×ž×•×¢", "××©×ž×— ×× ×ª×•×›×œ", "××©×ž×— ×× ×ª×•×›×œ×™",
        "×× ××¤×©×¨", "×× × ×™×ª×Ÿ", "×›×©×ª×•×›×œ", "×›×©×ª×•×›×œ×™", "×›×©× ×•×— ×œ×š", "×›×©×™×ª××¤×©×¨",
        "×›×©×ª×”×™×” ××¤×©×¨×•×ª", "×‘×–×ž× ×š ×”×—×•×¤×©×™", "×›×©×ª×ž×¦× ×–×ž×Ÿ",

        // ×”×•×¨×“×ª ×œ×—×¥
        "×‘×œ×™ ×œ×—×¥", "×œ×œ× ×œ×—×¥", "××™×Ÿ ×“×—×™×¤×•×ª", "×œ× ×“×—×•×£", "×ž×ª×™ ×©× ×•×—",
        "×›×©×ª×¨×’×™×© ×ž×ª××™×", "××™×Ÿ ×©×•× ×œ×—×¥", "××¤×©×¨ ×’× ×‘×”×ž×©×š", "××¤×©×¨ ×’× ××—×¨ ×›×š",

        // ××ž×¤×ª×™×” ×•×”×‘× ×”
        "×ž×‘×™× ×”", "×ž×‘×™×Ÿ", "×× ×™ ×ž×‘×™× ×”", "×× ×™ ×ž×‘×™×Ÿ", "×ž×‘×™× ×” ×œ×’×ž×¨×™", "×ž×‘×™×Ÿ ×œ×’×ž×¨×™",
        "×× ×™ ×ž×‘×™× ×” ××•×ª×š", "×× ×™ ×ž×‘×™×Ÿ ××•×ª×š", "×ž×‘×™× ×” ××ª ×”×ž×•×¨×›×‘×•×ª",
        "×ž×‘×™×Ÿ ××ª ×”×ž×¦×‘", "×–×” ×ž×•×‘×Ÿ", "×ž×•×‘×Ÿ ×œ×’×ž×¨×™", "× ×©×ž×¢ ×”×’×™×•× ×™",

        // ×—×™×•×‘ ×¨×’×©×™
        "×ž×¢×¨×™×›×” ××ª ×”×ž××ž×¥", "×ž×¢×¨×™×š ××ª ×”×ž××ž×¥", "×©×ž×—×” ×œ×©×ž×•×¢", "×©×ž×— ×œ×©×ž×•×¢",
        "×›×™×£ ×œ×©×ž×•×¢", "××™×–×” ×™×•×¤×™", "××™×–×” ×›×™×£", "××™×–×• ×”×§×œ×”", "×˜×•×‘ ×œ×©×ž×•×¢",

        // ×©×™×ª×•×£ ×¤×¢×•×œ×”
        "× ×©×ž×— ×œ×©×ª×£ ×¤×¢×•×œ×”", "××©×ž×— ×œ×©×ª×£ ×¤×¢×•×œ×”", "×‘×™×—×“ × ×¤×ª×•×¨", "× ×ž×¦× ×¤×ª×¨×•×Ÿ",
        "××¤×©×¨ ×œ×—×©×•×‘ ×™×—×“", "× ×©×ž×— ×œ×”×ª×§×“×", "×ž×•×›×Ÿ ×œ×¢×–×•×¨", "×ž×•×›× ×” ×œ×¢×–×•×¨",
        "×‘×©×ž×—×” ××¢×–×•×¨", "×‘×©×ž×—×” × ×¢×–×•×¨",

        // ×¡×’×™×¨×” × ×¢×™×ž×”
        "×‘×”×¦×œ×—×”", "×”×ž×•×Ÿ ×”×¦×œ×—×”", "×™×•× ×˜×•×‘", "×™×•× × ×¤×œ×", "×”×ž×©×š ×™×•× × ×¢×™×",
        "×¡×•×£ ×©×‘×•×¢ × ×¢×™×", "×¢×¨×‘ ×˜×•×‘", "×ª×•×“×” ×ž×¨××©",
        "××™×Ÿ ×‘×¢×™×”",
        "×‘×œ×™ ×‘×¢×™×”",
        "×‘×©×ž×—×”",
        "×›×ž×•×‘×Ÿ",
        "×‘×•×•×“××™",
        "×‘×˜×—",
        "×¡×’×•×¨",
        "×ž×¢×•×œ×”",
        "×ž×¦×•×™×Ÿ",
        "× ×”×“×¨",
        "×ž×¢×•×œ×” ×œ×’×ž×¨×™",
        "× ×©×ž×¢ ×˜×•×‘",
        "× ×©×ž×¢ ×ž×¦×•×™×Ÿ",
        "×”×›×œ ×‘×¡×“×¨",
        "×”×›×œ ×˜×•×‘",
        "××™×Ÿ ×©×•× ×‘×¢×™×”",
        "××™×Ÿ ×“×—×™×¤×•×ª",
        "×œ× ×‘×•×¢×¨",
        "×§×—×™ ××ª ×”×–×ž×Ÿ",
        "×§×— ××ª ×”×–×ž×Ÿ",

        // --- ×ª×•×“×” / ×”×¢×¨×›×” ---
        "×ª×•×“×”",
        "×ª×•×“×” ×¨×‘×”",
        "×”×ž×•×Ÿ ×ª×•×“×”",
        "×ª×•×“×” ×¢×œ ×”×¢×“×›×•×Ÿ",
        "×ª×•×“×” ×¢×œ ×”×˜×™×¤×•×œ",
        "×ª×•×“×” ×¢×œ ×”×”×©×§×¢×”",
        "×ž×¢×¨×™×›×”",
        "×ž×¢×¨×™×š",
        "×ž××•×“ ×ž×¢×¨×™×›×”",
        "×ž××•×“ ×ž×¢×¨×™×š",
        "×”×¢×¨×›×” ×¨×‘×”",
        "×›×œ ×”×›×‘×•×“",
        "×™×™×©×¨ ×›×•×—",

        // --- ×¤×¨×’×•×Ÿ ×ž×§×¦×•×¢×™ ---
        "×¢×‘×•×“×” ×ž×¦×•×™× ×ª",
        "×¢×‘×•×“×” ×ž×¢×•×œ×”",
        "×¢×©×™×ª ×¢×‘×•×“×” ×ž×¢×•×œ×”",
        "×¢×©×™×ª ×¢×‘×•×“×” ×ž×¦×•×™× ×ª",
        "×˜×™×¤×•×œ ×ž×¦×•×™×Ÿ",
        "×˜×™×¤×•×œ ×ž×¢×•×œ×”",
        "×¤×ª×¨×•×Ÿ ×ž×¦×•×™×Ÿ",
        "×¤×ª×¨×•×Ÿ ×˜×•×‘",
        "×ž×§×¦×•×¢×™ ×ž××•×“",
        "× ×¢×©×” ×‘×¦×•×¨×” ×ž×§×¦×•×¢×™×ª",
        "× ×¨××” ×˜×•×‘",
        "× ×¨××” ×ž×¦×•×™×Ÿ",
        "×ž×¨×©×™×",
        "×©××¤×•",
        "×›×œ ×”×›×‘×•×“ ×¢×œ ×–×”",

        // --- ×¨×›×•×ª / × ×™×ž×•×¡ ---
        "××©×ž×—",
        "××©×ž×— ×œ×¢×“×›×•×Ÿ",
        "××©×ž×— ×œ×©×ž×•×¢",
        "×× ××¤×©×¨",
        "×× ×™×ª××¤×©×¨",
        "×›×©× ×•×— ×œ×š",
        "×›×©× ×•×— ×œ×›×",
        "×›×©×ª×•×›×œ",
        "×›×©×ª×•×›×œ×™",
        "×‘×œ×™ ×œ×—×¥",
        "×œ×œ× ×œ×—×¥",
        "×œ× ×“×—×•×£",
        "×¨×§ ×›×©×ª×”×™×” ××¤×©×¨×•×ª",
        "×›×©×™×”×™×” ×–×ž×Ÿ",

        // --- ××ž×¤×ª×™×” / ×”×›×œ×” ---
        "×ž×‘×™× ×”",
        "×ž×‘×™×Ÿ",
        "×ž×‘×™× ×” ××•×ª×š",
        "×ž×‘×™×Ÿ ××•×ª×š",
        "×ž×‘×™× ×” ×œ×’×ž×¨×™",
        "×ž×‘×™×Ÿ ×œ×’×ž×¨×™",
        "×‘×¨×•×¨ ×œ×™",
        "×–×” ×ž×•×‘×Ÿ",
        "×”×’×™×•× ×™ ×œ×’×ž×¨×™",
        "×œ×’×ž×¨×™ ×ž×•×‘×Ÿ",
        "×©×•×ž×¢×ª ××•×ª×š",
        "×©×•×ž×¢ ××•×ª×š",

        // --- ×—×™×•×‘ ×¨×’×©×™ ---
        "×©×ž×—×ª×™ ×œ×©×ž×•×¢",
        "×©×ž×— ×œ×©×ž×•×¢",
        "×›×™×£ ×œ×©×ž×•×¢",
        "×ž×©×ž×—",
        "×–×” ×ž×©×ž×—",
        "××™×–×” ×™×•×¤×™",
        "××™×–×” ×›×™×£",
        "×ž×¢×•×“×“ ×œ×©×ž×•×¢",
        "× ×”× ×™×ª×™ ×œ×§×¨×•×",

        // --- ×—×™×‘×” / ×—×•× (×›×Ÿ, ×’× ×–×”) ---
        "××•×”×‘×ª ××•×ª×š",
        "××•×”×‘ ××•×ª×š",
        "×ž×¢×¨×™×›×” ××•×ª×š",
        "×ž×¢×¨×™×š ××•×ª×š",
        "×©×ž×—×” ×œ×¢×‘×•×“ ××™×ª×š",
        "×©×ž×— ×œ×¢×‘×•×“ ××™×ª×š",
        "×›×™×£ ×œ×¢×‘×•×“ ××™×ª×š",
        "× ×¢×™× ×œ×¢×‘×•×“ ××™×ª×š",

        // --- ×¡×™×•× ×—×™×•×‘×™ ---
        "×‘×”×¦×œ×—×”",
        "×”×ž×•×Ÿ ×‘×”×¦×œ×—×”",
        "×©×™×”×™×” ×‘×”×¦×œ×—×”",
        "×™×•× × ×¢×™×",
        "×™×•× ×˜×•×‘",
        "×”×ž×©×š ×™×•× × ×¢×™×",
        "×©×‘×•×¢ ×˜×•×‘",
        "×¡×•×¤×´×© × ×¢×™×"

      ]
      ,
      // =====================
      // ðŸŸ¡ NEUTRAL / ×œ×—×¥ / ×‘×™×§×•×¨×ª ×¢×“×™× ×”
      // =====================
      neutral_phrases: [
        // ×ž×¢×§×‘ ×•×œ×—×¥ ×ž×ª×•×Ÿ
        "×¨×§ ×œ×‘×“×•×§", "×¨×§ ×œ×•×•×“×", "×¨×¦×™×ª×™ ×œ×‘×“×•×§",
        "×¨×¦×™×ª×™ ×œ×•×•×“×", "×—×•×–×¨×ª ××œ×™×š",
        "×¤×•× ×” ×©×•×‘", "×ž×¢×“×›× ×ª ×©×•×‘",

        // ×”×ž×ª× ×”
        "×¢×“×™×™×Ÿ ×œ×", "×¢×•×“ ×œ×", "×˜×¨× ×§×™×‘×œ×ª×™",
        "×œ× ×§×™×‘×œ×ª×™ ×ª×©×•×‘×”", "×œ× ×—×–×¨×ª× ××œ×™×™",
        "×œ× ×—×–×¨×ª ××œ×™×™", "×œ× ×—×–×¨×ª×",

        // ×–×ž×Ÿ ×•×“×—×™×¤×•×ª ×¨×›×”
        "×›×‘×¨ ×›×ž×” ×™×ž×™×", "×›×‘×¨ ×©×‘×•×¢",
        "×ž×—×›×” ×œ×ª×©×•×‘×”", "×× ×™ ×ž×ž×ª×™× ×”",
        "××©×ž×— ×œ×”×ª×™×™×—×¡×•×ª", "××©×ž×— ×œ×“×¢×ª",

        // × ×™×¡×•×— ×¨×©×ž×™
        "×œ×¤×™ ×”×¡×™×›×•×", "×›×¤×™ ×©×¡×•×›×",
        "×‘×”×ž×©×š ×œ×©×™×—×”", "×‘×”×ž×©×š ×œ×”×ª×›×ª×‘×•×ª",
        "×‘×”×ž×©×š ×œ×¤× ×™×™×” ×”×§×•×“×ž×ª",

        // ×—×•×¡×¨ ×‘×”×™×¨×•×ª
        "×œ× ×‘×¨×•×¨ ×œ×™", "××¤×©×¨ ×œ×”×¡×‘×™×¨",
        "××©×ž×— ×œ×”×‘×”×¨×”", "×ž×” ×”×¡×˜×˜×•×¡",
        "×ž×” ×”×›×•×•× ×”", "×œ× ×”×¦×œ×—×ª×™ ×œ×”×‘×™×Ÿ",

        // ×œ×—×¥ ×œ×©×•× ×™
        "×—×©×•×‘ ×œ×™ ×œ×¦×™×™×Ÿ", "×—×©×•×‘ ×œ×™ ×œ×”×‘×™×Ÿ",
        "× ×“×¨×© ×˜×™×¤×•×œ", "× ×“×¨×© ×ž×¢× ×”",
        "×™×© ×¦×•×¨×š ×‘×¢×“×›×•×Ÿ"
      ],

      // =====================
      // ðŸ”´ DANGER / ×›×¢×¡ / ×”××©×ž×” / ×–×œ×–×•×œ
      // =====================
      danger_phrases: [
        // ×›×¢×¡ ×•×ª×¡×›×•×œ
        "× ×ž××¡ ×œ×™", "×“×™ ×›×‘×¨", "×›×ž×” ××¤×©×¨",
        "×–×” ×ž×ª×¡×›×œ", "×ž×ª×¡×›×œ ×ž××•×“",
        "×–×” ×ž×¢×¦×‘×Ÿ", "×ž×ž×© ×ž×¢×¦×‘×Ÿ",

        // ×”××©×ž×” ×™×©×™×¨×”
        "××ª ×œ× ×¢×•× ×”", "××ª×” ×œ× ×¢×•× ×”",
        "××ª ×œ× ×ž×’×™×‘×”", "××ª×” ×œ× ×ž×’×™×‘",
        "××ª ×ž×ª×¢×œ×ž×ª", "××ª×” ×ž×ª×¢×œ×",

        // ×›×©×œ ×•×—×•×¡×¨ ×ª×¤×§×•×“
        "×œ× ×˜×™×¤×œ×ª", "×œ× ×‘×“×§×ª",
        "×œ× ×¢×“×›× ×ª", "×œ× ×‘×•×¦×¢",
        "×–×” ×œ× ×˜×•×¤×œ", "×œ× ×˜×•×¤×œ ×‘×›×œ×œ",

        // ×”×¤×¨×ª ×”×ª×—×™×™×‘×•×ª
        "×”×‘×˜×—×ª ×•×œ×", "××ž×¨×ª ×•×œ×",
        "×¡×™×›×ž× ×• ×•×œ×", "×–×” ×œ× ×§×¨×”",
        "×–×” ×œ× ×‘×•×¦×¢",

        // ×–×œ×–×•×œ / ×¤×’×™×¢×”
        "×—×•×¡×¨ ×ž×§×¦×•×¢×™×•×ª", "×—×•×¡×¨ ××—×¨×™×•×ª",
        "×”×ª× ×”×œ×•×ª ×œ× ×ž×§×¦×•×¢×™×ª",
        "×”×ª× ×”×œ×•×ª ×œ× ×ª×§×™× ×”",

        // ×©×™×¤×•×˜×™×•×ª ×—×¨×™×¤×”
        "×–×” ×œ× ×ž×§×•×‘×œ", "×–×” ×œ× ×¡×‘×™×¨",
        "×œ× ×”×’×™×•× ×™", "×‘×œ×ª×™ ×¡×‘×™×¨",
        "×”×–×•×™ ×œ×—×œ×•×˜×™×Ÿ",

        // ×¢×œ×‘×•× ×•×ª
        "×ª×ª×‘×™×™×©", "×ª×ª×‘×™×™×©×™",
        "×ž×‘×™×š ×ž××•×“", "×‘×™×–×™×•×Ÿ",
        "×¤×ª×˜×™", "×ž×’×•×—×š",

        // ×”×¡×œ×ž×”
        "×–×” ×œ× ×™×™×’×ž×¨ ×›×›×”",
        "×™×”×™×• ×œ×–×” ×”×©×œ×›×•×ª",
        "×× ×™ ×œ× ××©×ª×•×§",
        "××ª× ×¢×•×“ ×ª×¦×˜×¢×¨×•",

        // ×ž×¦×‘×™ ×§×¦×”
        "××¡×•×Ÿ ×ž×•×—×œ×˜",
        "×§×˜×¡×˜×¨×•×¤×”",
        "×›×™×©×œ×•×Ÿ ×ž×•×—×œ×˜"
      ],

      escalation_signs: ESCALATION_SIGNS
    },

    // =====================================================
    // ENGLISH
    // =====================================================
    en: {
      positive_phrases: [
        "no problem", "no worries", "of course", "sure",
        "sounds good", "all good", "happy to help",
        "thank you", "thanks a lot", "much appreciated",
        "when you can", "no rush", "take your time",
        "just letting you know", "happy to check",
        "looks good", "makes sense"
      ],

      neutral_phrases: [
        "just checking", "following up",
        "still waiting", "haven't heard back",
        "any update", "please advise",
        "as discussed", "per our conversation",
        "according to our agreement",
        "can you clarify", "not clear yet",
        "awaiting your response"
      ],

      danger_phrases: [
        "this is frustrating", "i'm very frustrated",
        "this is unacceptable", "not acceptable",
        "this is not okay", "not okay at all",
        "you didn't respond", "you ignored",
        "you failed to", "this wasn't handled",
        "lack of professionalism",
        "this is ridiculous", "this makes no sense",
        "you promised and didn't",
        "there will be consequences",
        "this won't end well",
        "this is a complete failure"
      ],

      escalation_signs: ESCALATION_SIGNS
    }
  };

  function quickRiskScoreClient(text, lang = "he") {
    if (!text || !text.trim()) return 0;

    const lex = LEXICON[lang] || LEXICON.he;
    const t = text.toLowerCase();
    let score = 0;

    lex.positive_phrases.forEach(p => {
      if (t.includes(p)) score -= 2;
    });

    lex.neutral_phrases.forEach(p => {
      if (t.includes(p)) score += 2;
    });

    lex.danger_phrases.forEach(p => {
      if (t.includes(p)) score += 4;
    });

    if (lex.escalation_signs.some(s => text.includes(s))) {
      score += 3;
    }

    return Math.max(score, 0);
  }

  window.ChatLexicon = {
    LEXICON,
    quickRiskScoreClient
  };

})();
